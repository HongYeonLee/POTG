{% extends "index.html" %}

{% block custom_css %}
    <link rel="stylesheet" href="../static/grpurchase_ViewAll.css">
    <link rel="stylesheet" type="text/css" href="../static/indexStyle.css">
   
{% endblock %}

{% block section %}


    <!-- 카테고리 -->
    <section class="category-section"> 
        <h2 class="category-name">카테고리</h2>
        <div class="category-container">
            <div class="category-item">화장품</div>
            <div class="category-item">의류</div>
            <div class="category-item">육류 및 해산물</div>
            <div class="category-item">가공식품</div>
            <div class="category-item">과일 및 채소</div>
            <div class="category-item">냉동식품</div>
            <div class="category-item">전자제품</div>
            <div class="category-item">기타</div>
        </div>
    </section>
    <section class="content-container">

        <!-- 좌측 필터 -->
        <aside class="filter-section">
            <a href="/view_grReg">상품 조회</a>
            <h3>필터</h3>
            <hr>
            <form>
                <div class="filter-group">
                    <h3>남은기간</h3>
                    <div class="filter-item">
                        <input type="checkbox" id="1w">
                        <label for="1w">1주일 이내</label>
                    </div>
                    <div class="filter-item">
                        <input type="checkbox" id="3d">
                        <label for="3d">3일 이내</label>
                    </div>
                    <div class="filter-item">
                        <input type="checkbox" id="1d">
                        <label for="1d">24시간 이내</label>
                    </div>
                    <div class="filter-item">
        
                        <label for="dt"><img src="../static/images/icon_cal.png"> 기간설정<br><br>
                            <input type="date" value="2024-12-15">
                        </label>
                        
                    </div>

                </div>
                <hr>
                <div class="filter-group">
                    <h3>진행사항</h3>
                    <div class="filter-item">
                        <input type="checkbox" id="9">
                        <label for="9">90%~</label>
                    </div>
                    <div class="filter-item">
                        <input type="checkbox" id="8">
                        <label for="8">80%~</label>
                    </div>
                    <div class="filter-item">
                        <input type="checkbox" id="7">
                        <label for="7">70%~</label>
                    </div>
                    <div class="filter-item">
                        <input type="checkbox" id="6">
                        <label for="6">60%~</label>
                    </div>
                    <div class="filter-item">
                
                        <label for="6"> <img src="../static/images/icon_star.png"> 인원<br><br>
                            <input type="number" id="6" min="0" value="0">
                        </label>
            
                    </div>
                    

                </div>
                <hr>
                <div class="filter-group">
                    <h3>혜택</h3>
                    <div class="filter-item">
                        <input type="checkbox" id="sale">
                        <label for="sale">할인상품</label>
                    </div>
                </div>


            </form>
        </aside>
        <!--상품 리스트 추가-->
        {% if total > 0 %}
        <div class="product-list">
            <div class="product-sort">
                <div class = "product-header">
                    <p class = "total-count">총 {{total}}건</p>
                </div>
            </div>
            <div class="product-container">
                {% for key, value in row1 %}
                <div class="product-item">
                    <img class="product-image" src="../static/images/inputImages/{{value['img_path']}}" alt="{{key}}" style = "cursor: pointer;">
                    <button onClick="location.href='/grpurchaseDetail/{{key}}';" style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day">D-3</p>
                        <p class="product-name">{{key}}</p>
                        <p class="prog">총량 :  / {{value['cnt']}}</p>
                        <p class="product-price">
                            <!--
                            <p class="original-price">20,000원</p>
                            <span class="discount-rate">10%</span>
                            -->
                            <span class="discounted-price">
                                {{value['price']}}원 ➡️ <span style="color:black;" class="per_price" data-price="{{value['price']}}" data-cnt="{{value['cnt']}}">  </span>원 (개당)
                            </span>
                        </p>
                    </div>
                </div>
                {% endfor %}

                {% for key, value in row2 %}
                <div class="product-item">
                    <img class="product-image" src="../static/images/inputImages/{{value['img_path']}}" alt="{{key}}" style = "cursor: pointer;">
                    <button onClick="location.href='/grpurchaseDetail/{{key}}';" style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day">D-3</p>
                        <p class="product-name">{{key}}</p>
                        <p class="prog">총량 :  / {{value['cnt']}}</p>
                        <p class="product-price">
                            <!--
                            <p class="original-price">20,000원</p>
                            <span class="discount-rate">10%</span>
                            -->
                            <span class="discounted-price">
                                {{value['price']}}원 ➡️ <span style="color:black;" class="per_price" data-price="{{value['price']}}" data-cnt="{{value['cnt']}}">  </span>원 (개당)
                            </span>
                        </p>
                    </div>
                </div>
                {% endfor %}

                {% for key, value in row3 %}
                <div class="product-item">
                    <img class="product-image" src="../static/images/inputImages/{{value['img_path']}}" alt="{{key}}" style = "cursor: pointer;">
                    <button onClick="location.href='/grpurchaseDetail/{{key}}';" style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day">D-3</p>
                        <p class="product-name">{{key}}</p>
                        <p class="prog">총량 :  / {{value['cnt']}}</p>
                        <p class="product-price">
                            <!--
                            <p class="original-price">20,000원</p>
                            <span class="discount-rate">10%</span>
                            -->
                            <span class="discounted-price">
                                {{value['price']}}원 ➡️ <span style="color:black;" class="per_price" data-price="{{value['price']}}" data-cnt="{{value['cnt']}}">  </span>원 (개당)
                            </span>
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>


        </div>
        <!--페이지네이션-->
    <div class = "page-wrap">
        <div class = "pagination">
            <a href = "#">&laquo; 이전</a>
            {% for i in range(page_count) %}
            <a href = "{{url_for('grpPurchase', page = i)}}" color = "black">{{i+1}}</a>
            {% endfor %}
            <a href = "#">다음 &raquo;</a>
        </div>
    </div>

        {%else%}
        <div class="product-list">
            <div class="product-sort">
                <div class = "product-header">
                    <p class = "total-count">총 0건</p>
                </div>
            </div>
        </div>  
        {% endif %}
        <script>
            // 모든 상품의 가격 정보를 업데이트
            document.querySelectorAll(".per_price").forEach(span => {
                const price = parseFloat(span.dataset.price); // `data-price` 속성 값 가져오기
                const cnt = parseInt(span.dataset.cnt, 10);  // `data-cnt` 속성 값 가져오기
                if (cnt > 0) {
                    const perPrice = (price / cnt); 
                    span.textContent = `${perPrice}`;
                } else {
                    span.textContent = '정보 없음'; // 개수가 0인 경우 처리
                }
            });
        </script>

        <!--
        <main class="product-list">
            <div class="product-sort">
                <div class = "product-header">
                    <p class = "total-count">총 34건</p>
                   
                </div>
            </div>
        
            <div class="product-container">
                <div class="product-item">
                    <img class="product-image" src="../static/images/공구_햇반솥반.png" alt="햇반솥반">
                    <button onClick="location.href='/grpurchaseDetail'" style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day">D-3</p>
                        <p class="product-name">[햇반] 솥반 12개</p>
                        <p class="prog">구매확정 / 총량 : 9개 / 12개</p>
                        <p class="product-price">
                            <p class="original-price">20,000원</p>
                            <span class="discount-rate">10%</span>
                            <span class="discounted-price">18,000원 ~ / 1,500원(개당)</span>
                        </p>
                        
                    </div>
                </div>

                <div class="product-item">
                    <img class="product-image" src="../static/images/공구_사과.png" alt="Product 2">
                    <button style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day">D-2</p>
                        <p class="product-name">강원도 고랭지 사과 15개</p>
                        <p class="prog">구매확정 / 총량 : 11개 / 15개</p>
                        <p class="product-price">
                            <p class="original-price">18,000원</p>
                            <span class="discount-rate">10%</span>
                            <span class="discounted-price">16,200원 ~ / 3,240원(개당)</span>
                        </p>
                        
                    </div>
                </div>
                <div class="product-item">
                    <img class="product-image" src="../static/images/공구_갈비.png" alt="Product 3">
                    <button style="color: rgb(145, 145, 145);" class="add-to-cart">참여하기</button>
                    <div class="product-info">
                        <p class="d-day" style="color: rgb(206, 24, 24);">D-Day 03:04:16</p>
                        <p class="product-name">[능원가든]양념 LA 갈비 9팩</p>
                        <p class="prog">구매확정 / 총량 : 8팩 / 9팩</p>
                        <p class="product-price">
                            <p class="original-price">45,000원</p>
                            <span class="discount-rate"></span>
                            <span class="discounted-price">45,000원 ~ / 5,000원(개당)</span>
                        </p>
                        
                    </div>
                </div>
            </div>
        </main>
    
    </div>
    
-->

         
{% endblock section %}